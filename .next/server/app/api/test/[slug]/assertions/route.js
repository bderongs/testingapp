(()=>{var e={};e.id=222,e.ids=[222],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},1421:e=>{"use strict";e.exports=require("node:child_process")},1455:e=>{"use strict";e.exports=require("node:fs/promises")},4379:e=>{"use strict";e.exports=require("node:path")},4191:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>j,routeModule:()=>y,serverHooks:()=>$,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>k});var i={};s.r(i),s.d(i,{POST:()=>v,runtime:()=>c});var r=s(2706),a=s(8203),n=s(5994),o=s(1455),l=s(4379),u=s(1421),p=s(9187);let c="nodejs",d=(0,l.join)(process.cwd(),"output","user-stories.json"),h=(0,l.join)(process.cwd(),"output","playwright"),g=async e=>{try{let t=await (0,o.readFile)(e,"utf8");return JSON.parse(t)}catch{return null}},m=(e,t)=>{let s=[],i=e.toLowerCase();if(i.includes("title")){let t=e.match(/title matches "([^"]+)"/i)||e.match(/title[^"]*"([^"]+)"/i)||e.match(/title[^"]*is "([^"]+)"/i);if(t){let e=t[1];s.push(`await expect(page).toHaveTitle(/${f(e)}/i);`)}}if(i.includes("heading")){let t=e.match(/heading displays "([^"]+)"/i)||e.match(/(?:primary )?heading[^"]*"([^"]+)"/i);if(t){let e=t[1];s.push(`await expect(page.getByRole('heading', { name: /${f(e)}/i })).toBeVisible();`)}}if(i.includes("cta")&&(i.includes("visible")||i.includes("interactive"))){let i=e.match(/CTA "([^"]+)"/i)||e.match(/cta[^"]*"([^"]+)"/i),r=i?i[1]:t.primaryCtaLabel;r&&s.push(`await expect(page.getByRole('button', { name: /${f(r)}/i }).or(page.getByRole('link', { name: /${f(r)}/i })).first()).toBeVisible();`)}if(i.includes("navigation link")||i.includes("link")&&i.includes("visible")&&!i.includes("cta")){let t=e.match(/navigation link "([^"]+)"/i)||e.match(/link "([^"]+)"[^"]*visible/i)||e.match(/link[^"]*"([^"]+)"[^"]*remains visible/i);if(t){let e=t[1];s.push(`await expect(page.getByRole('link', { name: /${f(e)}/i }).first()).toBeVisible();`)}}return i.includes("form")&&(i.includes("accept")||i.includes("validation")||i.includes("field"))&&(s.push("const formFields = page.locator('input, textarea, select');"),s.push("await expect(formFields.first()).toBeVisible();")),s},f=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),w=e=>{let t=[];return t.push("import { test, expect } from 'playwright/test';"),t.push(""),t.push(`test.describe('${e.suggestedScriptName}', () => {`),t.push("  test('Validate baseline assertions', async ({ page }) => {"),t.push(`    await page.goto('${e.entryUrl}', { waitUntil: 'networkidle' });`),t.push(""),e.baselineAssertions.forEach((s,i)=>{t.push(`    await test.step('Assertion ${i+1}: ${s}', async () => {`);let r=m(s,e);r.length>0?r.forEach(e=>t.push(`      ${e}`)):(t.push("      // TODO: Could not parse assertion automatically"),t.push(`      // Assertion: ${s}`)),t.push("    });"),t.push("")}),t.push("  });"),t.push("});"),t.join("\n")},x=e=>new Promise(t=>{let s=(0,u.spawn)("npx",["playwright","test",e,"--reporter=list"],{cwd:process.cwd(),shell:"win32"===process.platform,env:{...process.env,CI:"false"}}),i="";s.stdout.on("data",e=>{i+=e.toString()}),s.stderr.on("data",e=>{i+=e.toString()}),s.on("close",e=>{t({code:e??1,output:i})})});async function v(e,{params:t}){let s=(await t).slug.replace(/[^a-z0-9-]/g,"");try{let e=(await g(d)??[]).find(e=>e.suggestedScriptName.replace(/[^a-z0-9-]/g,"")===s);if(!e)return p.NextResponse.json({success:!1,message:"Story not found"},{status:404});let t=w(e),i=(0,l.join)(h,`${s}.assertions.spec.ts`);await (0,o.mkdir)(h,{recursive:!0}),await (0,o.writeFile)(i,t,"utf8");let{code:r,output:a}=await x(i),n=e.baselineAssertions.map((e,t)=>{let s;let i=t+1,n=a.includes(`Assertion ${i}`)&&(a.includes("failed")||a.includes("Error")||a.includes("Timeout"));if(n){let e=a.match(RegExp(`Assertion ${i}[\\s\\S]*?Error:([^\\n]+)`,"i"));s=e?e[1].trim():"Assertion validation failed"}return{assertion:e,passed:0===r&&!n,error:s,duration:0}});return p.NextResponse.json({success:0===r,message:0===r?"All assertions passed":"Some assertions failed",assertionResults:n,output:a,code:r})}catch(e){return p.NextResponse.json({success:!1,message:"Failed to validate assertions",error:e.message},{status:500})}}let y=new r.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/test/[slug]/assertions/route",pathname:"/api/test/[slug]/assertions",filename:"route",bundlePath:"app/api/test/[slug]/assertions/route"},resolvedPagePath:"/Users/baptiste/Sites/testingapp/src/app/api/test/[slug]/assertions/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:b,workUnitAsyncStorage:k,serverHooks:$}=y;function j(){return(0,n.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:k})}},6487:()=>{},8335:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[638,452],()=>s(4191));module.exports=i})();