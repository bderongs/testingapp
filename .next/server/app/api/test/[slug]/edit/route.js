(()=>{var e={};e.id=785,e.ids=[785],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},1455:e=>{"use strict";e.exports=require("node:fs/promises")},4379:e=>{"use strict";e.exports=require("node:path")},4335:(e,t,s)=>{"use strict";let n,r,i,a;s.r(t),s.d(t,{patchFetch:()=>nW,routeModule:()=>nM,serverHooks:()=>nD,workAsyncStorage:()=>nL,workUnitAsyncStorage:()=>nB});var o,l,c,u,h,d,p,f,m,g,y,w,_,b,v,x,S,$,A,O,I,k,R,P,E,N,j,C,T,M,L,B,D,W,q,F,U,J,X,H,K,V,z,Y,G,Q,Z,ee,et,es,en,er,ei,ea,eo,el,ec,eu,eh,ed,ep,ef,em,eg,ey,ew,e_,eb,ev,ex,eS,e$,eA,eO,eI,ek,eR={};s.r(eR),s.d(eR,{POST:()=>nT,runtime:()=>nO});var eP=s(2706),eE=s(8203),eN=s(5994),ej=s(1455),eC=s(4379);function eT(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eM(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let eL=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eL=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function eB(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eD=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eW extends Error{}class eq extends eW{constructor(e,t,s,n){super(`${eq.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new eU({message:s,cause:eD(t)});let r=t?.error;return 400===e?new eX(e,r,s,n):401===e?new eH(e,r,s,n):403===e?new eK(e,r,s,n):404===e?new eV(e,r,s,n):409===e?new ez(e,r,s,n):422===e?new eY(e,r,s,n):429===e?new eG(e,r,s,n):e>=500?new eQ(e,r,s,n):new eq(e,r,s,n)}}class eF extends eq{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eU extends eq{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eJ extends eU{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eX extends eq{}class eH extends eq{}class eK extends eq{}class eV extends eq{}class ez extends eq{}class eY extends eq{}class eG extends eq{}class eQ extends eq{}class eZ extends eW{constructor(){super("Could not parse response content as the length limit was reached")}}class e0 extends eW{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class e1 extends Error{constructor(e){super(e)}}let e2=/^[a-z][a-z0-9+.-]*:/i,e3=e=>e2.test(e),e4=e=>(e4=Array.isArray)(e),e8=e4;function e5(e){return"object"!=typeof e?{}:e??{}}function e6(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e9=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eW(`${e} must be an integer`);if(t<0)throw new eW(`${e} must be a positive integer`);return t},e7=e=>{try{return JSON.parse(e)}catch(e){return}},te=e=>new Promise(t=>setTimeout(t,e)),tt="6.7.0",ts=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,tn=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":ti(Deno.build.os),"X-Stainless-Arch":tr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":ti(globalThis.process.platform??"unknown"),"X-Stainless-Arch":tr(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},tr=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ti=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",ta=()=>n??(n=tn());function to(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function tl(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return to({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function tc(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tu(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let th=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),td="RFC3986",tp=e=>String(e),tf={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:tp},tm=(e,t)=>(tm=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),tg=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function ty(e,t){if(e4(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let tw={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},t_=function(e,t){Array.prototype.push.apply(e,e4(t)?t:[t])},tb={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tg[n];continue}if(n<2048){s[s.length]=tg[192|n>>6]+tg[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tg[224|n>>12]+tg[128|n>>6&63]+tg[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tg[240|n>>18]+tg[128|n>>12&63]+tg[128|n>>6&63]+tg[128|63&n]}a+=s.join("")}return a},encodeValuesOnly:!1,format:td,formatter:tp,indices:!1,serializeDate:e=>(r??(r=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tv={};function tx(e){let t;return(i??(i=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tS(e){let t;return(a??(a=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class t${constructor(){o.set(this,void 0),l.set(this,void 0),eT(this,o,new Uint8Array,"f"),eT(this,l,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tx(e):e;eT(this,o,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eM(this,o,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eM(this,o,"f"),eM(this,l,"f")));){if(t.carriage&&null==eM(this,l,"f")){eT(this,l,t.index,"f");continue}if(null!=eM(this,l,"f")&&(t.index!==eM(this,l,"f")+1||t.carriage)){n.push(tS(eM(this,o,"f").subarray(0,eM(this,l,"f")-1))),eT(this,o,eM(this,o,"f").subarray(eM(this,l,"f")),"f"),eT(this,l,null,"f");continue}let e=null!==eM(this,l,"f")?t.preceding-1:t.preceding,s=tS(eM(this,o,"f").subarray(0,e));n.push(s),eT(this,o,eM(this,o,"f").subarray(t.index),"f"),eT(this,l,null,"f")}return n}flush(){return eM(this,o,"f").length?this.decode("\n"):[]}}o=new WeakMap,l=new WeakMap,t$.NEWLINE_CHARS=new Set(["\n","\r"]),t$.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let tA={off:0,error:200,warn:300,info:400,debug:500},tO=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(tA,e))return e;tE(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(tA))}`)}};function tI(){}function tk(e,t,s){return!t||tA[e]>tA[s]?tI:t[e].bind(t)}let tR={error:tI,warn:tI,info:tI,debug:tI},tP=new WeakMap;function tE(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tR;let n=tP.get(t);if(n&&n[0]===s)return n[1];let r={error:tk("error",t,s),warn:tk("warn",t,s),info:tk("info",t,s),debug:tk("debug",t,s)};return tP.set(t,[s,r]),r}let tN=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tj{constructor(e,t,s){this.iterator=e,c.set(this,void 0),this.controller=t,eT(this,c,s,"f")}static fromSSEResponse(e,t,s){let n=!1,r=s?tE(s):console;return new tj(async function*(){if(n)throw new eW("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(let n of tC(e,t))if(!s){if(n.data.startsWith("[DONE]")){s=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new eq(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw r.error("Could not parse message into JSON:",n.data),r.error("From chunk:",n.raw),e}if(t&&t.error)throw new eq(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(eB(e))return;throw e}finally{s||t.abort()}},t,s)}static fromReadableStream(e,t,s){let n=!1;async function*r(){let t=new t$;for await(let s of tc(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tj(async function*(){if(n)throw new eW("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eB(e))return;throw e}finally{e||t.abort()}},t,s)}[(c=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tj(()=>n(e),this.controller,eM(this,c,"f")),new tj(()=>n(t),this.controller,eM(this,c,"f"))]}toReadableStream(){let e;let t=this;return to({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tx(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tC(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eW("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eW("Attempted to iterate over a response with no body")}let s=new tM,n=new t$;for await(let t of tT(tc(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tT(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tx(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tM{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),":",e.substring(s+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function tL(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tE(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):tj.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tB(await s.json(),s):await s.text()})();return tE(e).debug(`[${n}] response parsed`,tN({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tB(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tD extends Promise{constructor(e,t,s=tL){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,u.set(this,void 0),eT(this,u,e,"f")}_thenUnwrap(e){return new tD(eM(this,u,"f"),this.responsePromise,async(t,s)=>tB(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eM(this,u,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}u=new WeakMap;class tW{constructor(e,t,s,n){h.set(this,void 0),eT(this,h,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eW("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eM(this,h,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(h=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tq extends tD{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tL(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tF extends tW{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tU extends tW{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...e5(this.options.query),after:t}}:null}}class tJ extends tW{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...e5(this.options.query),after:e}}:null}}let tX=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tH(e,t,s){return tX(),new File(e,t??"unknown_file",s)}function tK(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tV=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tz=async(e,t)=>t1(e.body)?{...e,body:await tQ(e.body,t)}:e,tY=async(e,t)=>({...e,body:await tQ(e.body,t)}),tG=new WeakMap,tQ=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tG.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tG.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>t2(s,e,t))),s},tZ=e=>e instanceof Blob&&"name"in e,t0=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tV(e)||tZ(e)),t1=e=>{if(t0(e))return!0;if(Array.isArray(e))return e.some(t1);if(e&&"object"==typeof e){for(let t in e)if(t1(e[t]))return!0}return!1},t2=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tH([await s.blob()],tK(s)));else if(tV(s))e.append(t,tH([await new Response(tl(s)).blob()],tK(s)));else if(tZ(s))e.append(t,s,tK(s));else if(Array.isArray(s))await Promise.all(s.map(s=>t2(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>t2(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},t3=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,t4=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&t3(e),t8=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function t5(e,t,s){if(tX(),t4(e=await e))return e instanceof File?e:tH([await e.arrayBuffer()],e.name);if(t8(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tH(await t6(n),t,s)}let n=await t6(e);if(t||(t=tK(e)),!s?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tH(n,t,s)}async function t6(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(t3(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tV(e))for await(let s of e)t.push(...await t6(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class t9{constructor(e){this._client=e}}function t7(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let se=Object.freeze(Object.create(null)),st=((e=t7)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,i=[],a=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(r=!0);let o=s[a],l=(r?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??se)??se)?.toString)&&(l=o+"",i.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)i.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eW(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(t7);class ss extends t9{list(e,t={},s){return this._client.getAPIList(st`/chat/completions/${e}/messages`,tU,{query:t,...s})}}function sn(e){return void 0!==e&&"function"in e&&void 0!==e.function}function sr(e){return e?.$brand==="auto-parseable-response-format"}function si(e){return e?.$brand==="auto-parseable-tool"}function sa(e,t){let s=e.choices.map(e=>{var s;if("length"===e.finish_reason)throw new eZ;if("content_filter"===e.finish_reason)throw new e0;return sl(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>sn(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:si(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=e.message.content,t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(s):JSON.parse(s):null):null}}});return{...e,choices:s}}function so(e){return!!sr(e.response_format)||(e.tools?.some(e=>si(e)||"function"===e.type&&!0===e.function.strict)??!1)}function sl(e){for(let t of e||[])if("function"!==t.type)throw new eW(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let sc=e=>e?.role==="assistant",su=e=>e?.role==="tool";class sh{constructor(){d.add(this),this.controller=new AbortController,p.set(this,void 0),f.set(this,()=>{}),m.set(this,()=>{}),g.set(this,void 0),y.set(this,()=>{}),w.set(this,()=>{}),_.set(this,{}),b.set(this,!1),v.set(this,!1),x.set(this,!1),S.set(this,!1),eT(this,p,new Promise((e,t)=>{eT(this,f,e,"f"),eT(this,m,t,"f")}),"f"),eT(this,g,new Promise((e,t)=>{eT(this,y,e,"f"),eT(this,w,t,"f")}),"f"),eM(this,p,"f").catch(()=>{}),eM(this,g,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eM(this,d,"m",$).bind(this))},0)}_connected(){this.ended||(eM(this,f,"f").call(this),this._emit("connect"))}get ended(){return eM(this,b,"f")}get errored(){return eM(this,v,"f")}get aborted(){return eM(this,x,"f")}abort(){this.controller.abort()}on(e,t){return(eM(this,_,"f")[e]||(eM(this,_,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eM(this,_,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eM(this,_,"f")[e]||(eM(this,_,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eT(this,S,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eT(this,S,!0,"f"),await eM(this,g,"f")}_emit(e,...t){if(eM(this,b,"f"))return;"end"===e&&(eT(this,b,!0,"f"),eM(this,y,"f").call(this));let s=eM(this,_,"f")[e];if(s&&(eM(this,_,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eM(this,S,"f")||s?.length||Promise.reject(e),eM(this,m,"f").call(this,e),eM(this,w,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eM(this,S,"f")||s?.length||Promise.reject(e),eM(this,m,"f").call(this,e),eM(this,w,"f").call(this,e),this._emit("end")}}_emitFinal(){}}p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,x=new WeakMap,S=new WeakMap,d=new WeakSet,$=function(e){if(eT(this,v,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eF),e instanceof eF)return eT(this,x,!0,"f"),this._emit("abort",e);if(e instanceof eW)return this._emit("error",e);if(e instanceof Error){let t=new eW(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eW(String(e)))};class sd extends sh{constructor(){super(...arguments),A.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),su(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(sc(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eW("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eM(this,A,"m",O).call(this)}async finalMessage(){return await this.done(),eM(this,A,"m",I).call(this)}async finalFunctionToolCall(){return await this.done(),eM(this,A,"m",k).call(this)}async finalFunctionToolCallResult(){return await this.done(),eM(this,A,"m",R).call(this)}async totalUsage(){return await this.done(),eM(this,A,"m",P).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eM(this,A,"m",I).call(this);t&&this._emit("finalMessage",t);let s=eM(this,A,"m",O).call(this);s&&this._emit("finalContent",s);let n=eM(this,A,"m",k).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eM(this,A,"m",R).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eM(this,A,"m",P).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eM(this,A,"m",E).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(sa(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:i,...a}=t,o="string"!=typeof r&&"function"===r.type&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(si(e)){if(!e.$callback)throw new eW("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let h="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:h,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eW("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:i}=e.function,a=u[r];if(a){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=eM(this,A,"m",N).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}A=new WeakSet,O=function(){return eM(this,A,"m",I).call(this).content??null},I=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(sc(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eW("stream ended without producing a ChatCompletionMessage with role=assistant")},k=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sc(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},R=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(su(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},P=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},E=function(e){if(null!=e.n&&e.n>1)throw new eW("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},N=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class sp extends sd{static runTools(e,t,s){let n=new sp,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),sc(e)&&e.content&&this._emit("content",e.content)}}let sf={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sm extends Error{}class sg extends Error{}let sy=(e,t)=>{let s=e.length,n=0,r=e=>{throw new sm(`${e} at position ${n}`)},i=e=>{throw new sg(`${e} at position ${n}`)},a=()=>(h(),n>=s&&r("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||sf.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||sf.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||sf.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||sf.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||sf.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||sf.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u(),o=()=>{let a=n,o=!1;for(n++;n<s&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(o)))}catch(e){i(String(e))}else if(sf.STR&t)try{return JSON.parse(e.substring(a,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,h();let i={};try{for(;"}"!==e[n];){if(h(),n>=s&&sf.OBJ&t)return i;let r=o();h(),n++;try{let e=a();Object.defineProperty(i,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sf.OBJ&t)return i;throw e}h(),","===e[n]&&n++}}catch(e){if(sf.OBJ&t)return i;r("Expected '}' at end of object")}return n++,i},c=()=>{n++;let s=[];try{for(;"]"!==e[n];)s.push(a()),h(),","===e[n]&&n++}catch(e){if(sf.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&sf.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sf.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||sf.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(s){"-"===e.substring(a,n)&&sf.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},h=()=>{for(;n<s&&" \n\r	".includes(e[n]);)n++};return a()},sw=e=>(function(e,t=sf.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sy(e.trim(),t)})(e,sf.ALL^sf.NUM);class s_ extends sd{constructor(e){super(),j.add(this),C.set(this,void 0),T.set(this,void 0),M.set(this,void 0),eT(this,C,e,"f"),eT(this,T,[],"f")}get currentChatCompletionSnapshot(){return eM(this,M,"f")}static fromReadableStream(e){let t=new s_(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new s_(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eM(this,j,"m",L).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eM(this,j,"m",D).call(this,e);if(r.controller.signal?.aborted)throw new eF;return this._addChatCompletion(eM(this,j,"m",F).call(this))}async _fromReadableStream(e,t){let s;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eM(this,j,"m",L).call(this),this._connected();let r=tj.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eM(this,j,"m",F).call(this)),eM(this,j,"m",D).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eF;return this._addChatCompletion(eM(this,j,"m",F).call(this))}[(C=new WeakMap,T=new WeakMap,M=new WeakMap,j=new WeakSet,L=function(){this.ended||eT(this,M,void 0,"f")},B=function(e){let t=eM(this,T,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eM(this,T,"f")[e.index]=t),t},D=function(e){if(this.ended)return;let t=eM(this,j,"m",J).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eM(this,j,"m",B).call(this,e);for(let t of(e.finish_reason&&(eM(this,j,"m",q).call(this,e),null!=n.current_tool_call_index&&eM(this,j,"m",W).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eM(this,j,"m",q).call(this,e),null!=n.current_tool_call_index&&eM(this,j,"m",W).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},W=function(e,t){if(eM(this,j,"m",B).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eM(this,C,"f")?.tools?.find(e=>sn(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:si(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},q=function(e){let t=eM(this,j,"m",B).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eM(this,j,"m",U).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},F=function(){if(this.ended)throw new eW("stream has ended, this shouldn't happen");let e=eM(this,M,"f");if(!e)throw new eW("request ended without sending any chunks");return eT(this,M,void 0,"f"),eT(this,T,[],"f"),function(e,t){var s;let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new eW(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new eW(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eW(`missing function_call.arguments for choice ${n}`);if(!l)throw new eW(`missing function_call.name for choice ${n}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...i,index:n,finish_reason:s,logprobs:r,message:{...c,role:u,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:i,id:a,...o}=t,{arguments:l,name:c,...u}=r||{};if(null==a)throw new eW(`missing choices[${n}].tool_calls[${s}].id
${sb(e)}`);if(null==i)throw new eW(`missing choices[${n}].tool_calls[${s}].type
${sb(e)}`);if(null==c)throw new eW(`missing choices[${n}].tool_calls[${s}].function.name
${sb(e)}`);if(null==l)throw new eW(`missing choices[${n}].tool_calls[${s}].function.arguments
${sb(e)}`);return{...o,id:a,type:i,function:{...u,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&so(t)?sa(s,t):{...s,choices:s.choices.map(e=>(sl(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eM(this,C,"f"))},U=function(){let e=eM(this,C,"f")?.response_format;return sr(e)?e:null},J=function(e){var t,s,n,r;let i=eM(this,M,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:u=null,...h}of(i?Object.assign(i,o):i=eT(this,M,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...h}),u){if(e.logprobs){let{content:n,refusal:r,...i}=u;Object.assign(e.logprobs,i),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},u)}if(l&&(e.finish_reason=l,eM(this,C,"f")&&so(eM(this,C,"f")))){if("length"===l)throw new eZ;if("content_filter"===l)throw new e0}if(Object.assign(e,h),!a)continue;let{content:o,refusal:d,function_call:p,role:f,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eM(this,j,"m",U).call(this)&&(e.message.parsed=sw(e.message.content))),m)for(let{index:t,id:s,type:n,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,a),s&&(o.id=s),n&&(o.type=n),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>sn(e)&&e.function?.name===t.function.name);return sn(s)&&(si(s)||s?.function.strict||!1)}(eM(this,C,"f"),o)&&(o.function.parsed_arguments=sw(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tj(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sb(e){return JSON.stringify(e)}class sv extends s_{static fromReadableStream(e){let t=new sv(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new sv(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sx extends t9{constructor(){super(...arguments),this.messages=new ss(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(st`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(st`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tU,{query:e,...t})}delete(e,t){return this._client.delete(st`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new eW(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eW(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>sa(t,e))}runTools(e,t){return e.stream?sv.runTools(this._client,e,t):sp.runTools(this._client,e,t)}stream(e,t){return s_.createChatCompletion(this._client,e,t)}}sx.Messages=ss;class sS extends t9{constructor(){super(...arguments),this.completions=new sx(this._client)}}sS.Completions=sx;let s$=Symbol("brand.privateNullableHeaders"),sA=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,i]of function*(e){let t;if(!e)return;if(s$ in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():e8(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=e8(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[s$]:!0,values:t,nulls:s}};class sO extends t9{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sA([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sI extends t9{create(e,t){return this._client.post("/audio/transcriptions",tY({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sk extends t9{create(e,t){return this._client.post("/audio/translations",tY({body:e,...t,__metadata:{model:e.model}},this._client))}}class sR extends t9{constructor(){super(...arguments),this.transcriptions=new sI(this._client),this.translations=new sk(this._client),this.speech=new sO(this._client)}}sR.Transcriptions=sI,sR.Translations=sk,sR.Speech=sO;class sP extends t9{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(st`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tU,{query:e,...t})}cancel(e,t){return this._client.post(st`/batches/${e}/cancel`,t)}}class sE extends t9{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(st`/assistants/${e}`,{...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(st`/assistants/${e}`,{body:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tU,{query:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(st`/assistants/${e}`,{...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sN extends t9{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sj extends t9{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sC extends t9{constructor(){super(...arguments),this.sessions=new sN(this._client),this.transcriptionSessions=new sj(this._client)}}sC.Sessions=sN,sC.TranscriptionSessions=sj;class sT extends t9{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:sA([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(st`/chatkit/sessions/${e}/cancel`,{...t,headers:sA([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class sM extends t9{retrieve(e,t){return this._client.get(st`/chatkit/threads/${e}`,{...t,headers:sA([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",tJ,{query:e,...t,headers:sA([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(st`/chatkit/threads/${e}`,{...t,headers:sA([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList(st`/chatkit/threads/${e}/items`,tJ,{query:t,...s,headers:sA([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}class sL extends t9{constructor(){super(...arguments),this.sessions=new sT(this._client),this.threads=new sM(this._client)}}sL.Sessions=sT,sL.Threads=sM;class sB extends t9{create(e,t,s){return this._client.post(st`/threads/${e}/messages`,{body:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(st`/threads/${n}/messages/${e}`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(st`/threads/${n}/messages/${e}`,{body:r,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(st`/threads/${e}/messages`,tU,{query:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(st`/threads/${n}/messages/${e}`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sD extends t9{retrieve(e,t,s){let{thread_id:n,run_id:r,...i}=t;return this._client.get(st`/threads/${n}/runs/${r}/steps/${e}`,{query:i,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(st`/threads/${n}/runs/${e}/steps`,tU,{query:r,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sW=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}},sq=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sF extends sh{constructor(){super(...arguments),X.add(this),K.set(this,[]),V.set(this,{}),z.set(this,{}),Y.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0),en.set(this,void 0),er.set(this,void 0)}[(K=new WeakMap,V=new WeakMap,z=new WeakMap,Y=new WeakMap,G=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,en=new WeakMap,er=new WeakMap,X=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new H;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tj.fromReadableStream(e,this.controller);for await(let e of n)eM(this,X,"m",ei).call(this,e);if(n.controller.signal?.aborted)throw new eF;return this._addRun(eM(this,X,"m",ea).call(this))}toReadableStream(){return new tj(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eM(this,X,"m",ei).call(this,e);if(a.controller.signal?.aborted)throw new eF;return this._addRun(eM(this,X,"m",ea).call(this))}static createThreadAssistantStream(e,t,s){let n=new H;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eM(this,es,"f")}currentRun(){return eM(this,en,"f")}currentMessageSnapshot(){return eM(this,Y,"f")}currentRunStepSnapshot(){return eM(this,er,"f")}async finalRunSteps(){return await this.done(),Object.values(eM(this,V,"f"))}async finalMessages(){return await this.done(),Object.values(eM(this,z,"f"))}async finalRun(){if(await this.done(),!eM(this,G,"f"))throw Error("Final run was not received.");return eM(this,G,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))eM(this,X,"m",ei).call(this,e);if(i.controller.signal?.aborted)throw new eF;return this._addRun(eM(this,X,"m",ea).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eM(this,X,"m",ei).call(this,e);if(a.controller.signal?.aborted)throw new eF;return this._addRun(eM(this,X,"m",ea).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(e6(t)&&e6(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!e6(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}H=sF,ei=function(e){if(!this.ended)switch(eT(this,es,e,"f"),eM(this,X,"m",ec).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eM(this,X,"m",ep).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eM(this,X,"m",el).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eM(this,X,"m",eo).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ea=function(){if(this.ended)throw new eW("stream has ended, this shouldn't happen");if(!eM(this,G,"f"))throw Error("Final run has not been received");return eM(this,G,"f")},eo=function(e){let[t,s]=eM(this,X,"m",eh).call(this,e,eM(this,Y,"f"));for(let e of(eT(this,Y,t,"f"),eM(this,z,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eM(this,Q,"f")){if(eM(this,Z,"f"))switch(eM(this,Z,"f").type){case"text":this._emit("textDone",eM(this,Z,"f").text,eM(this,Y,"f"));break;case"image_file":this._emit("imageFileDone",eM(this,Z,"f").image_file,eM(this,Y,"f"))}eT(this,Q,s.index,"f")}eT(this,Z,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eM(this,Q,"f")){let t=e.data.content[eM(this,Q,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eM(this,Y,"f"));break;case"text":this._emit("textDone",t.text,eM(this,Y,"f"))}}eM(this,Y,"f")&&this._emit("messageDone",e.data),eT(this,Y,void 0,"f")}},el=function(e){let t=eM(this,X,"m",eu).call(this,e);switch(eT(this,er,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eM(this,ee,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eM(this,et,"f")&&this._emit("toolCallDone",eM(this,et,"f")),eT(this,ee,e.index,"f"),eT(this,et,t.step_details.tool_calls[e.index],"f"),eM(this,et,"f")&&this._emit("toolCallCreated",eM(this,et,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eT(this,er,void 0,"f"),"tool_calls"==e.data.step_details.type&&eM(this,et,"f")&&(this._emit("toolCallDone",eM(this,et,"f")),eT(this,et,void 0,"f")),this._emit("runStepDone",e.data,t)}},ec=function(e){eM(this,K,"f").push(e),this._emit("event",e)},eu=function(e){switch(e.event){case"thread.run.step.created":return eM(this,V,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eM(this,V,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=H.accumulateDelta(t,s.delta);eM(this,V,"f")[e.data.id]=n}return eM(this,V,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eM(this,V,"f")[e.data.id]=e.data}if(eM(this,V,"f")[e.data.id])return eM(this,V,"f")[e.data.id];throw Error("No snapshot available")},eh=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eM(this,X,"m",ed).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ed=function(e,t){return H.accumulateDelta(t,e)},ep=function(e){switch(eT(this,en,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eT(this,G,e.data,"f"),eM(this,et,"f")&&(this._emit("toolCallDone",eM(this,et,"f")),eT(this,et,void 0,"f"))}};class sU extends t9{constructor(){super(...arguments),this.steps=new sD(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(st`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(st`/threads/${n}/runs/${e}`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(st`/threads/${n}/runs/${e}`,{body:r,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(st`/threads/${e}/runs`,tU,{query:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(st`/threads/${n}/runs/${e}/cancel`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sF.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sA([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await te(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sF.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(st`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sF.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sU.Steps=sD;class sJ extends t9{constructor(){super(...arguments),this.runs=new sU(this._client),this.messages=new sB(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(st`/threads/${e}`,{...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(st`/threads/${e}`,{body:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(st`/threads/${e}`,{...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sF.createThreadAssistantStream(e,this._client.beta.threads,t)}}sJ.Runs=sU,sJ.Messages=sB;class sX extends t9{constructor(){super(...arguments),this.realtime=new sC(this._client),this.chatkit=new sL(this._client),this.assistants=new sE(this._client),this.threads=new sJ(this._client)}}sX.Realtime=sC,sX.ChatKit=sL,sX.Assistants=sE,sX.Threads=sJ;class sH extends t9{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sK extends t9{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(st`/containers/${n}/files/${e}/content`,{...s,headers:sA([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sV extends t9{constructor(){super(...arguments),this.content=new sK(this._client)}create(e,t,s){return this._client.post(st`/containers/${e}/files`,tY({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(st`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(st`/containers/${e}/files`,tU,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(st`/containers/${n}/files/${e}`,{...s,headers:sA([{Accept:"*/*"},s?.headers])})}}sV.Content=sK;class sz extends t9{constructor(){super(...arguments),this.files=new sV(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(st`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tU,{query:e,...t})}delete(e,t){return this._client.delete(st`/containers/${e}`,{...t,headers:sA([{Accept:"*/*"},t?.headers])})}}sz.Files=sV;class sY extends t9{create(e,t,s){let{include:n,...r}=t;return this._client.post(st`/conversations/${e}/items`,{query:{include:n},body:r,...s})}retrieve(e,t,s){let{conversation_id:n,...r}=t;return this._client.get(st`/conversations/${n}/items/${e}`,{query:r,...s})}list(e,t={},s){return this._client.getAPIList(st`/conversations/${e}/items`,tJ,{query:t,...s})}delete(e,t,s){let{conversation_id:n}=t;return this._client.delete(st`/conversations/${n}/items/${e}`,s)}}class sG extends t9{constructor(){super(...arguments),this.items=new sY(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(st`/conversations/${e}`,t)}update(e,t,s){return this._client.post(st`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(st`/conversations/${e}`,t)}}sG.Items=sY;class sQ extends t9{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tE(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tE(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=sW(t)}),e)))}}class sZ extends t9{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(st`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(st`/evals/${n}/runs/${e}/output_items`,tU,{query:r,...s})}}class s0 extends t9{constructor(){super(...arguments),this.outputItems=new sZ(this._client)}create(e,t,s){return this._client.post(st`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(st`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(st`/evals/${e}/runs`,tU,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(st`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(st`/evals/${n}/runs/${e}`,s)}}s0.OutputItems=sZ;class s1 extends t9{constructor(){super(...arguments),this.runs=new s0(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(st`/evals/${e}`,t)}update(e,t,s){return this._client.post(st`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tU,{query:e,...t})}delete(e,t){return this._client.delete(st`/evals/${e}`,t)}}s1.Runs=s0;class s2 extends t9{create(e,t){return this._client.post("/files",tY({body:e,...t},this._client))}retrieve(e,t){return this._client.get(st`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tU,{query:e,...t})}delete(e,t){return this._client.delete(st`/files/${e}`,t)}content(e,t){return this._client.get(st`/files/${e}/content`,{...t,headers:sA([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await te(t),i=await this.retrieve(e),Date.now()-r>s)throw new eJ({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class s3 extends t9{}class s4 extends t9{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class s8 extends t9{constructor(){super(...arguments),this.graders=new s4(this._client)}}s8.Graders=s4;class s5 extends t9{create(e,t,s){return this._client.getAPIList(st`/fine_tuning/checkpoints/${e}/permissions`,tF,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(st`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(st`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class s6 extends t9{constructor(){super(...arguments),this.permissions=new s5(this._client)}}s6.Permissions=s5;class s9 extends t9{list(e,t={},s){return this._client.getAPIList(st`/fine_tuning/jobs/${e}/checkpoints`,tU,{query:t,...s})}}class s7 extends t9{constructor(){super(...arguments),this.checkpoints=new s9(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(st`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tU,{query:e,...t})}cancel(e,t){return this._client.post(st`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(st`/fine_tuning/jobs/${e}/events`,tU,{query:t,...s})}pause(e,t){return this._client.post(st`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(st`/fine_tuning/jobs/${e}/resume`,t)}}s7.Checkpoints=s9;class ne extends t9{constructor(){super(...arguments),this.methods=new s3(this._client),this.jobs=new s7(this._client),this.checkpoints=new s6(this._client),this.alpha=new s8(this._client)}}ne.Methods=s3,ne.Jobs=s7,ne.Checkpoints=s6,ne.Alpha=s8;class nt extends t9{}class ns extends t9{constructor(){super(...arguments),this.graderModels=new nt(this._client)}}ns.GraderModels=nt;class nn extends t9{createVariation(e,t){return this._client.post("/images/variations",tY({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tY({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class nr extends t9{retrieve(e,t){return this._client.get(st`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tF,e)}delete(e,t){return this._client.delete(st`/models/${e}`,t)}}class ni extends t9{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class na extends t9{accept(e,t,s){return this._client.post(st`/realtime/calls/${e}/accept`,{body:t,...s,headers:sA([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post(st`/realtime/calls/${e}/hangup`,{...t,headers:sA([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post(st`/realtime/calls/${e}/refer`,{body:t,...s,headers:sA([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post(st`/realtime/calls/${e}/reject`,{body:t,...s,headers:sA([{Accept:"*/*"},s?.headers])})}}class no extends t9{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class nl extends t9{constructor(){super(...arguments),this.clientSecrets=new no(this._client),this.calls=new na(this._client)}}function nc(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,n,r;let i=(s=e.tools??[],n=t.name,s.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:(r=i,r?.$brand==="auto-parseable-tool")?i.$parseRaw(t.arguments):i?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s;return"output_text"===e.type?{...e,parsed:(s=e.text,t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(s):JSON.parse(s))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||nu(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function nu(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}nl.ClientSecrets=no,nl.Calls=na;class nh extends sh{constructor(e){super(),ef.add(this),em.set(this,void 0),eg.set(this,void 0),ey.set(this,void 0),eT(this,em,e,"f")}static createResponse(e,t,s){let n=new nh(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eM(this,ef,"m",ew).call(this);let i=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eM(this,ef,"m",e_).call(this,r,i);if(n.controller.signal?.aborted)throw new eF;return eM(this,ef,"m",eb).call(this)}[(em=new WeakMap,eg=new WeakMap,ey=new WeakMap,ef=new WeakSet,ew=function(){this.ended||eT(this,eg,void 0,"f")},e_=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eM(this,ef,"m",ev).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eW(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eW(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eW(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eW(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},eb=function(){if(this.ended)throw new eW("stream has ended, this shouldn't happen");let e=eM(this,eg,"f");if(!e)throw new eW("request ended without sending any events");eT(this,eg,void 0,"f");let t=function(e,t){return t&&sr(t.text?.format)?nc(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eM(this,em,"f"));return eT(this,ey,t,"f"),t},ev=function(e){let t=eM(this,eg,"f");if(!t){if("response.created"!==e.type)throw new eW(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eT(this,eg,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eW(`missing output at index ${e.output_index}`);let n=s.type,r=e.part;"message"===n&&"reasoning_text"!==r.type?s.content.push(r):"reasoning"===n&&"reasoning_text"===r.type&&(s.content||(s.content=[]),s.content.push(r));break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eW(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eW(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eW(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eW(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.reasoning_text.delta":{let s=t.output[e.output_index];if(!s)throw new eW(`missing output at index ${e.output_index}`);if("reasoning"===s.type){let t=s.content?.[e.content_index];if(!t)throw new eW(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new eW(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":eT(this,eg,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eM(this,ey,"f");if(!e)throw new eW("stream ended without producing a ChatCompletion");return e}}class nd extends t9{list(e,t={},s){return this._client.getAPIList(st`/responses/${e}/input_items`,tU,{query:t,...s})}}class np extends t9{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class nf extends t9{constructor(){super(...arguments),this.inputItems=new nd(this._client),this.inputTokens=new np(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nu(e),e))}retrieve(e,t={},s){return this._client.get(st`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nu(e),e))}delete(e,t){return this._client.delete(st`/responses/${e}`,{...t,headers:sA([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>nc(t,e))}stream(e,t){return nh.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(st`/responses/${e}/cancel`,t)}}nf.InputItems=nd,nf.InputTokens=np;class nm extends t9{create(e,t,s){return this._client.post(st`/uploads/${e}/parts`,tY({body:t,...s},this._client))}}class ng extends t9{constructor(){super(...arguments),this.parts=new nm(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(st`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(st`/uploads/${e}/complete`,{body:t,...s})}}ng.Parts=nm;let ny=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class nw extends t9{create(e,t,s){return this._client.post(st`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(st`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(st`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(st`/vector_stores/${n}/file_batches/${e}/files`,tU,{query:r,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sA([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await te(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(a).map(l);return await ny(c),await this.createAndPoll(e,{file_ids:o})}}class n_ extends t9{create(e,t,s){return this._client.post(st`/vector_stores/${e}/files`,{body:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(st`/vector_stores/${n}/files/${e}`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(st`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(st`/vector_stores/${e}/files`,tU,{query:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(st`/vector_stores/${n}/files/${e}`,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sA([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await te(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(st`/vector_stores/${n}/files/${e}/content`,tF,{...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nb extends t9{constructor(){super(...arguments),this.files=new n_(this._client),this.fileBatches=new nw(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(st`/vector_stores/${e}`,{...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(st`/vector_stores/${e}`,{body:t,...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tU,{query:e,...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(st`/vector_stores/${e}`,{...t,headers:sA([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(st`/vector_stores/${e}/search`,tF,{body:t,method:"post",...s,headers:sA([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nb.Files=n_,nb.FileBatches=nw;class nv extends t9{create(e,t){return this._client.post("/videos",tz({body:e,...t},this._client))}retrieve(e,t){return this._client.get(st`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",tJ,{query:e,...t})}delete(e,t){return this._client.delete(st`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(st`/videos/${e}/content`,{query:t,...s,headers:sA([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(st`/videos/${e}/remix`,tz({body:t,...s},this._client))}}class nx extends t9{constructor(){super(...arguments),ex.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");eM(this,ex,"m",eS).call(this,s);let r=sA([t]).values,i=eM(this,ex,"m",e$).call(this,r,"webhook-signature"),a=eM(this,ex,"m",e$).call(this,r,"webhook-timestamp"),o=eM(this,ex,"m",e$).call(this,r,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new e1("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new e1("Webhook timestamp is too old");if(l>c+n)throw new e1("Webhook timestamp is too new");let u=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(d)))return}catch{continue}throw new e1("The given webhook signature does not match the expected signature")}}ex=new WeakSet,eS=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},e$=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s};class nS{constructor({baseURL:e=sq("OPENAI_BASE_URL"),apiKey:t=sq("OPENAI_API_KEY"),organization:s=sq("OPENAI_ORG_ID")??null,project:n=sq("OPENAI_PROJECT_ID")??null,webhookSecret:r=sq("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(eA.add(this),eI.set(this,void 0),this.completions=new sH(this),this.chat=new sS(this),this.embeddings=new sQ(this),this.files=new s2(this),this.images=new nn(this),this.audio=new sR(this),this.moderations=new ni(this),this.models=new nr(this),this.fineTuning=new ne(this),this.graders=new ns(this),this.vectorStores=new nb(this),this.webhooks=new nx(this),this.beta=new sX(this),this.batches=new sP(this),this.uploads=new ng(this),this.responses=new nf(this),this.realtime=new nl(this),this.conversations=new sG(this),this.evals=new s1(this),this.containers=new sz(this),this.videos=new nv(this),void 0===t)throw new eW("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let a={apiKey:t,organization:s,project:n,webhookSecret:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&ts())throw new eW("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??eO.DEFAULT_TIMEOUT,this.logger=a.logger??console;let o="warn";this.logLevel=o,this.logLevel=tO(a.logLevel,"ClientOptions.logLevel",this)??tO(sq("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eT(this,eI,th,"f"),this._options=a,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return sA([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n=e,r=function(e=tb){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||tb.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=td;if(void 0!==e.format){if(!tm(tf,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tf[n],i=tb.filter;if(("function"==typeof e.filter||e4(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in tw?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":tb.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||tb.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:tb.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:tb.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:tb.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?tb.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:tb.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:tb.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:tb.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:tb.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:tb.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:tb.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:tb.strictNullHandling}}(t);"function"==typeof r.filter?n=(0,r.filter)("",n):e4(r.filter)&&(s=r.filter);let i=[];if("object"!=typeof n||null===n)return"";let a=tw[r.arrayFormat],o="comma"===a&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];r.skipNulls&&null===n[t]||t_(i,function e(t,s,n,r,i,a,o,l,c,u,h,d,p,f,m,g,y,w){var _,b;let v,x=t,S=w,$=0,A=!1;for(;void 0!==(S=S.get(tv))&&!A;){let e=S.get(t);if($+=1,void 0!==e){if(e===$)throw RangeError("Cyclic object value");A=!0}void 0===S.get(tv)&&($=0)}if("function"==typeof u?x=u(s,x):x instanceof Date?x=p?.(x):"comma"===n&&e4(x)&&(x=ty(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(a)return c&&!g?c(s,tb.encoder,y,"key",f):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,tb.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,tb.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let O=[];if(void 0===x)return O;if("comma"===n&&e4(x))g&&c&&(x=ty(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(e4(u))v=u;else{let e=Object.keys(x);v=h?e.sort(h):e}let I=l?String(s).replace(/\./g,"%2E"):String(s),k=r&&e4(x)&&1===x.length?I+"[]":I;if(i&&e4(x)&&0===x.length)return k+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,A=e4(x)?"function"==typeof n?n(k,S):k:k+(d?"."+S:"["+S+"]");w.set(t,$);let I=new WeakMap;I.set(tv,w),t_(O,e(b,A,n,r,i,a,o,l,"comma"===n&&g&&e4(x)?null:c,u,h,d,p,f,m,g,y,I))}return O}(n[t],t,a,o,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=i.join(r.delimiter),u=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${tt}`}defaultIdempotencyKey(){return`stainless-node-retry-${eL()}`}makeStatusError(e,t,s,n){return eq.generate(e,t,s,n)}async _callApiKey(){let e;let t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof eW)throw e;throw new eW(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new eW(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,s){let n=!eM(this,eA,"m",ek).call(this)&&s||this.baseURL,r=new URL(e3(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tD(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=await this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:a,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(tE(this).debug(`[${l}] sending request`,tN({retryOfRequestLogID:s,method:n.method,url:a,options:n,headers:i.headers})),n.signal?.aborted)throw new eF;let h=new AbortController,d=await this.fetchWithTimeout(a,i,o,h).catch(eD),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eF;let r=eB(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tE(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tE(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tN({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),this.retryRequest(n,t,s??l);if(tE(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tE(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tN({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),r)throw new eJ;throw new eU({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-u}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await tu(d.body),tE(this).info(`${m} - ${e}`),tE(this).debug(`[${l}] response error (${e})`,tN({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tE(this).info(`${m} - ${r}`);let i=await d.text().catch(e=>eD(e).message),a=e7(i),o=a?void 0:i;throw tE(this).debug(`[${l}] response error (${r})`,tN({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,a,o,d.headers)}return tE(this).info(m),tE(this).debug(`[${l}] response start`,tN({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),{response:d,options:n,controller:h,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tq(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:i,...a}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,n){let r;let i=n?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n?.get("retry-after");if(a&&!r){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await te(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:i,defaultBaseURL:a}=s,o=this.buildURL(r,i,a);"timeout"in s&&e9("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),u=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let i=sA([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ta(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sA([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:tl(e)}:eM(this,eI,"f").call(this,{body:e,headers:s})}}eO=nS,eI=new WeakMap,eA=new WeakSet,ek=function(){return"https://api.openai.com/v1"!==this.baseURL},nS.OpenAI=eO,nS.DEFAULT_TIMEOUT=6e5,nS.OpenAIError=eW,nS.APIError=eq,nS.APIConnectionError=eU,nS.APIConnectionTimeoutError=eJ,nS.APIUserAbortError=eF,nS.NotFoundError=eV,nS.ConflictError=ez,nS.RateLimitError=eG,nS.BadRequestError=eX,nS.AuthenticationError=eH,nS.InternalServerError=eQ,nS.PermissionDeniedError=eK,nS.UnprocessableEntityError=eY,nS.InvalidWebhookSignatureError=e1,nS.toFile=t5,nS.Completions=sH,nS.Chat=sS,nS.Embeddings=sQ,nS.Files=s2,nS.Images=nn,nS.Audio=sR,nS.Moderations=ni,nS.Models=nr,nS.FineTuning=ne,nS.Graders=ns,nS.VectorStores=nb,nS.Webhooks=nx,nS.Beta=sX,nS.Batches=sP,nS.Uploads=ng,nS.Responses=nf,nS.Realtime=nl,nS.Conversations=sG,nS.Evals=s1,nS.Containers=sz,nS.Videos=nv;var n$=s(9187),nA=s(379);let nO="nodejs",nI=nA.z.object({instruction:nA.z.string().min(1,"Instruction is required"),apply:nA.z.boolean().optional().default(!1),baselineAssertions:nA.z.array(nA.z.string()).optional()}),nk=new nS({apiKey:process.env.OPENAI_API_KEY}),nR=(0,eC.join)(process.cwd(),"output","playwright"),nP=(0,eC.join)(process.cwd(),"output","user-stories.json"),nE=(0,eC.join)(process.cwd(),"output","playwright",".backups"),nN=async()=>{try{await (0,ej.mkdir)(nE,{recursive:!0})}catch{}},nj=async e=>{await nN();let t=e.split("/").pop()||"unknown.spec.ts",s=new Date().toISOString().replace(/[:.]/g,"-"),n=(0,eC.join)(nE,`${t}.${s}.backup`);return await (0,ej.copyFile)(e,n),n},nC=async(e,t)=>{try{let t=await (0,ej.readFile)(e,"utf8");return JSON.parse(t)}catch(s){return console.error(`[edit] Failed to read ${t} from ${e}:`,s),null}};async function nT(e,{params:t}){let s=(await t).slug.replace(/[^a-z0-9-]/g,""),n=(0,eC.join)(nR,`${s}.spec.ts`);try{let t,r;let i=await e.json().catch(()=>({})),a=nI.safeParse(i);if(!a.success)return n$.NextResponse.json({success:!1,message:"Invalid payload",issues:a.error.issues},{status:400});let{instruction:o,apply:l,baselineAssertions:c}=a.data;if(!process.env.OPENAI_API_KEY)return n$.NextResponse.json({success:!1,message:"OPENAI_API_KEY is not configured"},{status:500});let u=await nC(nP,"stories")??[],h=u.find(e=>e.suggestedScriptName.replace(/[^a-z0-9-]/g,"")===s);if(!h)return n$.NextResponse.json({success:!1,message:"Story not found"},{status:404});let d=c||h.baselineAssertions;l&&(t=await nj(n));let p=`You are a test quality expert. Your task is to modify baseline assertions (user-friendly test requirements) based on user instructions.

Rules:
1. Return ONLY a JSON array of assertion strings, no explanations
2. Each assertion should be a clear, human-readable sentence describing what to check
3. Keep assertions concise and testable
4. Preserve assertions that are not being modified
5. Format: ["Assertion 1", "Assertion 2", ...]

The user will provide:
- Current baseline assertions
- A natural language instruction to modify them

Return the modified assertions as a JSON array.`,f=`Current baseline assertions:

${JSON.stringify(d,null,2)}

User instruction: "${o}"

Provide the modified baseline assertions as a JSON array:`,m=await nk.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:p},{role:"user",content:f}],temperature:.2,max_tokens:2e3,response_format:{type:"json_object"}}),g=m.choices[0]?.message?.content?.trim()||"{}";try{let e=JSON.parse(g);r=Array.isArray(e)?e:e.assertions||e.baselineAssertions||[]}catch{let e=g.match(/\[[\s\S]*?\]/);if(e)r=JSON.parse(e[0]);else throw Error("Failed to parse modified assertions from AI response")}if(!Array.isArray(r)||0===r.length)throw Error("AI did not return a valid array of assertions");if(l){let e=u.map(e=>e.suggestedScriptName.replace(/[^a-z0-9-]/g,"")===s?{...e,baselineAssertions:r}:e);await (0,ej.writeFile)(nP,JSON.stringify(e,null,2)+"\n","utf8");let t=await (0,ej.readFile)(n,"utf8"),i=`You are a Playwright expert. Generate a complete Playwright test from these baseline assertions:

${JSON.stringify(r,null,2)}

Current test code structure:
\`\`\`typescript
${t}
\`\`\`

Generate the complete updated Playwright test code that validates all the assertions. Keep the same structure (describe block, test block) but update the assertions to match the new baseline assertions.

Return ONLY the complete code, wrapped in a markdown code block.`,a=await nk.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a Playwright test expert. Generate valid Playwright test code."},{role:"user",content:i}],temperature:.2,max_tokens:4e3}),o=a.choices[0]?.message?.content?.trim()||"",l=o.match(/```(?:typescript|ts)?\n([\s\S]*?)\n```/),c=l?l[1]:o;await (0,ej.writeFile)(n,c,"utf8")}return n$.NextResponse.json({success:!0,original:d,modified:r,message:l?"Test modified successfully":"Preview generated",backupPath:l?t:void 0})}catch(e){return n$.NextResponse.json({success:!1,message:"Failed to modify test",error:e.message},{status:500})}}let nM=new eP.AppRouteRouteModule({definition:{kind:eE.RouteKind.APP_ROUTE,page:"/api/test/[slug]/edit/route",pathname:"/api/test/[slug]/edit",filename:"route",bundlePath:"app/api/test/[slug]/edit/route"},resolvedPagePath:"/Users/baptiste/Sites/testingapp/src/app/api/test/[slug]/edit/route.ts",nextConfigOutput:"",userland:eR}),{workAsyncStorage:nL,workUnitAsyncStorage:nB,serverHooks:nD}=nM;function nW(){return(0,eN.patchFetch)({workAsyncStorage:nL,workUnitAsyncStorage:nB})}},6487:()=>{},8335:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[638,452,379],()=>s(4335));module.exports=n})();